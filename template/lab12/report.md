---
## Front matter
title: "Лабораторная работа №12"
subtitle: "Синхронизация времени"
author: "Спелов Андрей Николаевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Целью данной работы является получение навыков по управлению системным временем и настройке синхронизации времени.

# Выполнение лабораторной работы

На сервере посмотрим параметры настройки даты и времени, текущего системного времени и аппаратного времени(рис. [-@fig:001]).

![Просмотр на сервере параметров настройки даты и времени, текущего системного времени и аппаратного времени.](image/1.png){#fig:001 width=70%}

На клиенте посмотрим параметры настройки даты и времени, текущего системного времени и аппаратного времени (рис. [-@fig:002]).

![Просмотр на клиенте параметров настройки даты и времени, текущего системного времени и аппаратного времени.](image/2.png){#fig:002 width=70%}

Установим на сервере необходимое программное обеспечение(рис. [-@fig:003]).

![Установка на сервере программного обеспечения chrony.](image/3.png){#fig:003 width=70%}

Проверим источники времени на клиенте(рис. [-@fig:004]).

![Проверка источника времени на клиенте.](image/4.png){#fig:004 width=70%}

Проверим источники времени на сервере (рис. [-@fig:005]).

![Проверка источника времени на сервере.](image/5.png){#fig:005 width=70%}

На сервере откроем на редактирование файл /etc/chrony.conf и добавим строку (рис. [-@fig:006]).

![Открытие на сервере файла /etc/chrony.conf на редактирование и добавление строки.](image/6.png){#fig:006 width=70%}

На сервере перезапустим службу chronyd: 
systemctl restart chronyd 
И настроим межсетевой экран на сервер (рис. [-@fig:007]).

![Перезапуск на сервере службы chronyd и настройка межсетевого экрана..](image/7.png){#fig:007 width=70%}

На клиенте откроем файл /etc/chrony.conf и добавим строку: 
server server.anspelov.net iburst 
После чего удалим все остальные строки с директивой server(рис. [-@fig:008]).

![Открытие на клиенте файла /etc/chrony.conf и добавление строки. Удаление всех остальных строк с директивой server.](image/8.png){#fig:008 width=70%}

На клиенте перезапустим службу chronyd (рис. [-@fig:009]).

![Перезапуск на клиенте службы chronyd.](image/9.png){#fig:009 width=70%}

Проверим источники времени на клиенте(рис. [-@fig:010]).

![Проверка источника времени на клиенте.](image/10.png){#fig:010 width=70%}

Проверим источники времени на сервере(рис. [-@fig:011]).

![Проверка источника времени на сервере.](image/11.png){#fig:011 width=70%}

На виртуальной машине server перейдём в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/, создадим в нём каталог ntp, в который поместим в соответствующие подкаталоги конфигурационные файлы. В каталоге /vagrant/provision/server создадим исполняемый файл ntp.sh(рис. [-@fig:012]).

![Переход на виртуальной машине server в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/, создание в нём каталога ntp, в который помещаем в соответствующие подкаталоги конфигурационные файлы. Создание в каталоге /vagrant/provision/server исполняемого файла ntp.sh.](image/12.png){#fig:012 width=70%}

Открыв его на редактирование, пропишем в нём следующий скрипт из лабораторной работы (рис. [-@fig:013]).

![Открытие файла на редактирование и добавление скрипта.](image/13.png){#fig:013 width=70%}

На виртуальной машине client перейдём в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/client/, создадим в нём каталог ntp, в который поместим в соответствующие подкаталоги конфигурационные файлы. В каталоге /vagrant/provision/client создадим исполняемый файл ntp.sh(рис. [-@fig:014]).

![Переход на виртуальной машине client в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/client/, создание в нём каталога ntp, в который помещаем в соответствующие подкаталоги конфигурационные файлы. Создание в каталоге /vagrant/provision/client исполняемого файла ntp.sh.](image/14.png){#fig:014 width=70%}

Открыв его на редактирование, пропишем в нём следующий скрипт из лабораторной работы (рис. [-@fig:015]).

![Открытие файла на редактирование и добавление скрипта](image/15.png){#fig:015 width=70%}

Для отработки созданных скриптов во время загрузки виртуальных машин server и client в конфигурационном файле Vagrantfile добавим в соответствующих разделах конфигураций для сервера и клиента (рис. [-@fig:016]).

![Добавление записи в конфигурационном файле Vagrantfile для сервера и клиента](image/16.png){#fig:016 width=70%}

# Выводы

В ходе выполнения лабораторной работы были получены навыки по управлению системным временем и настройке синхронизации времени.

# Ответы на контрольные вопросы:

1.	Почему важна точная синхронизация времени для служб баз данных? – 
Синхронизация времени необходима для обеспечения корректности временных меток в базе данных.
Распределенные системы баз данных чувствительны к разнице во времени между узлами, и несогласованность времени может привести к проблемам с транзакциями и целостью данных.

2.	Почему служба проверки подлинности Kerberos сильно зависит от правильной синхронизации времени? – 
Kerberos использует временные метки для предотвращения атак воспроизведения билетов.
Если время не синхронизировано, билеты могут быть считаны как недействительные, что приведет к проблемам с аутентификацией.

3.	Какая служба используется по умолчанию для синхронизации времени на RHEL 7? - На RHEL 7 служба синхронизации времени по умолчанию - chrony.

4.	Какова страта по умолчанию для локальных часов? - Страта 0 (нулевая) - локальные часы, являющиеся источником времени.

5.	Какой порт брандмауэра должен быть открыт, если вы настраиваете свой сервер как одноранговый узел NTP? - Порт 123 (UDP) должен быть открыт для протокола NTP.

6.	Какую строку вам нужно включить в конфигурационный файл chrony, если вы хотите быть сервером времени, даже если внешние серверы NTP недоступны? – 
В конфигурационном файле /etc/chrony.conf добавьте строку:
local stratum 10

7.	Какую страту имеет хост, если нет текущей синхронизации времени NTP? - Страта 16 - хост без синхронизации времени NTP.

8.	Какую команду вы бы использовали на сервере с chrony, чтобы узнать, с какими серверами он синхронизируется? - chronyc sources -v.

9.	Как вы можете получить подробную статистику текущих настроек времени для процесса chrony вашего сервера? – 
chronyc tracking
Эта команда предоставляет подробную информацию о текущей синхронизации времени, дисперсии, коррекции часов и других параметрах.

# Список литературы{.unnumbered}

::: {#refs}
:::
