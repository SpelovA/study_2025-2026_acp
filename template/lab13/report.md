---
## Front matter
title: "Лабораторная работа №13"
subtitle: "Настройка NFS"
author: "Спелов Андрей Николаевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Целью данной работы является приобретение навыков настройки сервера NFS для удалённого доступа к ресурсам.

# Выполнение лабораторной работы

На сервере установим необходимое программное обеспечение(рис. [-@fig:001]).

![Установка на сервере программного обеспечения nfs-utils.](image/1.png){#fig:001 width=70%}

На сервере создадим каталог, который предполагается сделать доступным всем пользователям сети (корень дерева NFS) (рис. [-@fig:002]).

![Создание на сервере каталога, который предполагается сделать доступным всем пользователям сети (корень дерева NFS).](image/2.png){#fig:002 width=70%}

В файле /etc/exports пропишем подключаемый через NFS общий каталог с доступом только на чтение(рис. [-@fig:003]).

![Прописывание в файле /etc/exports подключаемого через NFS общего каталога с доступом только на чтение.](image/3.png){#fig:003 width=70%}

Для общего каталога зададим контекст безопасности NFS: 
semanage fcontext -a -t nfs_t "/srv/nfs(/.*)?" 
Применим изменённую настройку SELinux к файловой системе: 
restorecon -vR /srv/nfs 
Запустим сервер NFS: 
systemctl start nfs-server.service 
systemctl enable nfs-server.service 
Настроим межсетевой экран для работы сервера NFS(рис. [-@fig:004]).

![Настройка для общего каталога контекста безопасности NFS, применение изменённой настройки SELinux к файловой системе, запуск сервера NFS и настройка межсетевого экрана для работы сервера NFS.](image/4.png){#fig:004 width=70%}

На клиенте установим необходимое для работы NFS программное обеспечение (рис. [-@fig:005]).

![Установка на клиенте программного обеспечения для работы NFS.](image/5.png){#fig:005 width=70%}

На клиенте попробуем посмотреть имеющиеся подмонтированные удалённые ресурсы (рис. [-@fig:006]).

![Попытка просмотреть на клиенте имеющихся подмонтированных удалённых ресурсов.](image/6.png){#fig:006 width=70%}

Попробуем на сервере остановить сервис межсетевого экрана (рис. [-@fig:007]).

![Попытка остановить на сервере сервис межсетевого экрана.](image/7.png){#fig:007 width=70%}

Затем на клиенте вновь попробуем подключиться к удалённо смонтированному ресурсу(рис. [-@fig:008]).

![Повторная попытка подключения к удалённо смонтированному ресурсу.](image/8.png){#fig:008 width=70%}

На сервере запустим сервис межсетевого экрана (рис. [-@fig:009]).

![Запуск на сервере сервиса межсетевого экрана.](image/9.png){#fig:009 width=70%}

На сервере посмотрим, какие службы задействованы при удалённом монтировании: 
lsof | grep TCP(рис. [-@fig:010]).

![Просмотр на сервере служб, задействованных при удалённом монтировании (TCP).](image/10.png){#fig:010 width=70%}

На сервере посмотрим, какие службы задействованы при удалённом монтировании: 
lsof | grep UDP(рис. [-@fig:011]).

![Просмотр на сервере служб, задействованных при удалённом монтировании (UDP).](image/11.png){#fig:011 width=70%}

Добавим службы rpc-bind и mountd в настройки межсетевого экрана на сервере(рис. [-@fig:012]).

![Добавление службы rpc-bind и mountd в настройки межсетевого экрана на сервере.](image/12.png){#fig:012 width=70%}

На клиенте проверим подключение удалённого ресурса (рис. [-@fig:013]).

![Проверка на клиенте подключения удалённого ресурса.](image/13.png){#fig:013 width=70%}

На клиенте создадим каталог, в который будем монтировать удалённый ресурс, и подмонтируем дерево NFS. После чего проверим, что общий ресурс NFS подключён правильно(рис. [-@fig:014]).

![Создание на клиенте каталога, в который будет монтироваться удалённый ресурс, и монтироваться дерево NFS. Проверка, что общий ресурс NFS подключён правильно.](image/14.png){#fig:014 width=70%}

На клиенте в конце файла /etc/fstab добавим следующую запись (рис. [-@fig:015]).

![Добавление на клиенте в конце файла /etc/fstab записи.](image/15.png){#fig:015 width=70%}

На клиенте проверим наличие автоматического монтирования удалённых ресурсов при запуске операционной системы (рис. [-@fig:016]).

![Проверка на клиенте наличия автоматического монтирования удалённых ресурсов при запуске операционной системы.](image/16.png){#fig:016 width=70%}

На сервере создадим общий каталог, в который затем будет подмонтирован каталог с контентом веб-сервера: 
mkdir -p /srv/nfs/www 
После чего подмонтируем каталог web-сервера: 
mount -o bind /var/www/ /srv/nfs/www/ 
И на сервере проверим, что отображается в каталоге /srv/nfs(рис. [-@fig:017]).

![Создание на сервере общего каталога, в который затем будет подмонтирован каталог с контентом веб-сервера. Монтирование каталога web-сервера и проверка, что отображается в каталоге /srv/nfs.](image/17.png){#fig:017 width=70%}

На клиенте посмотрим, что отображается в каталоге /mnt/nfs (рис. [-@fig:018]).

![Просмотр на клиенте содержимого каталога /mnt/nfs.](image/18.png){#fig:018 width=70%}

На сервере в файле /etc/exports добавим экспорт каталога веб-сервера с удалённого ресурса(рис. [-@fig:019]).

![Добавление на сервере в файле /etc/exports экспорта каталога веб-сервера с удалённого ресурса.](image/19.png){#fig:019 width=70%}

Экспортируем все каталоги, упомянутые в файле /etc/exports(рис. [-@fig:020]).

![Экспорт всех каталогов, упомянутых в файле /etc/exports.](image/20.png){#fig:020 width=70%}

Проверим на клиенте каталог /mnt/nfs(рис. [-@fig:021]).

![Проверка на клиенте каталога /mnt/nfs.](image/21.png){#fig:021 width=70%}

На сервере в конце файла /etc/fstab добавим следующую запись(рис. [-@fig:022]).

![Добавление на сервере в конце файла /etc/fstab записи.](image/22.png){#fig:022 width=70%}

Повторно экспортируем каталоги, указанные в файле /etc/exports(рис. [-@fig:023]).

![Повторный экспорт каталогов, указанных в файле /etc/exports.](image/23.png){#fig:023 width=70%}

На клиенте проверим каталог /mnt/nfs(рис. [-@fig:024]).

![Проверка на клиенте каталога /mnt/nfs.](image/24.png){#fig:024 width=70%}

На сервере под пользователем anspelov в домашнем каталоге создадим каталог common с полными правами доступа только для этого пользователя, а в нём файл anspelov@server.txt. Далее создадим общий каталог для работы пользователя anspelov по сети и подмонтируем каталог common пользователя anspelov в NFS(рис. [-@fig:025]).

![Создание на сервере под пользователем anspelov в домашнем каталоге каталога common с полными правами доступа только для этого пользователя, а в нём файл anspelov@server.txt. Создание общего каталога для работы пользователя anspelov по сети и монтирование каталога common пользователя anspelov в NFS.](image/25.png){#fig:025 width=70%}

Подключим каталог пользователя в файле /etc/exports, прописав в нём(рис. [-@fig:026]).

![Подключение каталога пользователя в файле /etc/exports](image/26.png){#fig:026 width=70%}

Внесём изменения в файл /etc/fstab(рис. [-@fig:027]).

![Внесение изменения в файл /etc/fstab.](image/27.png){#fig:027 width=70%}

Повторно экспортируем каталоги(рис. [-@fig:028]).

![Повторный экспорт каталогов.](image/28.png){#fig:028 width=70%}

На клиенте проверим каталог /mnt/nfs(рис. [-@fig:029]).

![Проверка на клиенте каталога /mnt/nfs.](image/29.png){#fig:029 width=70%}

На клиенте под пользователем anspelov перейдём в каталог /mnt/nfs/home/anspelov и попробуем создать в нём файл anspelov@client.txt и внести в него какие-либо изменения(рис. [-@fig:030]).

![Переход на клиенте под пользователем anspelov в каталог /mnt/nfs/home/anspelov и попытка создать в нём файл anspelov@client.txt.](image/30.png){#fig:030 width=70%}

Попробуем также это проделать под пользователем root(рис. [-@fig:031]).

![Переход на клиенте под пользователем root в каталог /mnt/nfs/home/anspelov и попытка создать в нём файл anspelov@client.txt.](image/31.png){#fig:031 width=70%}

На сервере посмотрим, появились ли изменения в каталоге пользователя /home/anspelov/common(рис. [-@fig:032]).

![Просмотр наличия изменений на сервере в каталоге пользователя /home/anspelov/common.](image/32.png){#fig:032 width=70%}

На виртуальной машине server перейдём в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/, создадим в нём каталог nfs, в который поместим в соответствующие подкаталоги конфигурационные файлы. В каталоге /vagrant/provision/server создадим исполняемый файл nfs.sh(рис. [-@fig:033]).

![Переход на виртуальной машине server в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/, создание в нём каталога nfs, в который помещаем в соответствующие подкаталоги конфигурационные файлы. Создание в каталоге /vagrant/provision/server исполняемого файла nfs.sh.](image/33.png){#fig:033 width=70%}

Открываем его на редактирование и пропишем в нём следующий скрипт из лабораторной работы(рис. [-@fig:034]).

![Открытие файла на редактирование и добавление скрипта.](image/34.png){#fig:034 width=70%}

После чего на виртуальной машине client перейдём в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/client/. В каталоге /vagrant/provision/client создадим исполняемый файл nfs.sh(рис. [-@fig:035]).

![Переход на виртуальной машине client в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/client/. Создание в каталоге /vagrant/provision/client исполняемого файла nfs.sh.](image/35.png){#fig:035 width=70%}

Открываем его на редактирование и пропишем в нём следующий скрипт (рис. [-@fig:036]).

![Открытие файла на редактирование и добавление скрипта.](image/36.png){#fig:036 width=70%}

Для отработки созданных скриптов во время загрузки виртуальных машин server и client в конфигурационном файле Vagrantfile добавим в соответствующих разделах конфигураций для сервера и клиента(рис. [-@fig:037]).

![Добавление записи в конфигурационном файле Vagrantfile для сервера и для клиента.](image/37.png){#fig:037 width=70%}

# Выводы

В ходе выполнения лабораторной работы были приобретены навыки настройки сервера NFS для удалённого доступа к ресурсам.

# Ответы на контрольные вопросы:

1.	Как называется файл конфигурации, содержащий общие ресурсы NFS? - Файл конфигурации, содержащий общие ресурсы NFS, называется /etc/exports. В этом файле определяются каталоги, которые будут доступны для общего использования через NFS.

2.	Какие порты должны быть открыты в брандмауэре, чтобы обеспечить полный доступ к серверу NFS? - Для обеспечения полного доступа к серверу NFS, обычно открываются следующие порты:
TCP и UDP порт 2049: Основной порт для NFS.
TCP и UDP порт 111: Порт для службы rpcbind (или портmap), которая используется для регистрации служб RPC.
Порты для динамически выделяемых портов (обычно в диапазоне 32768-32779), используемых NFS для передачи данных.

3.	Какую опцию следует использовать в /etc/fstab, чтобы убедиться, что общие ресурсы NFS могут быть установлены автоматически при перезагрузке? - Для автоматической установки общих ресурсов NFS при загрузке системы, в файле /etc/fstab следует использовать опцию auto. Пример строки в /etc/fstab:
server:/remote/export /mnt/nfs_share nfs auto 0 0
Здесь server:/remote/export - адрес и путь к общему ресурсу NFS, /mnt/nfs_share - точка монтирования, nfs - тип файловой системы, auto - опция для автоматического монтирования при загрузке системы, 0 0 - опции для процесса проверки файловой системы при загрузке.

# Список литературы{.unnumbered}

::: {#refs}
:::
